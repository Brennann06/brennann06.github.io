<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brennan's Portfolio</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="transitions.js"></script>
</head>
<body>
    <div class="background"></div>
    <div id="particles-js"></div>
    <audio id="backgroundMusic" autoplay loop preload="auto">
        <source src="sounds/background.wav" type="audio/wav">
    </audio>
    <div class="settings-notification">
        <span class="icon">‚úÖ</span>
        <span class="message">Settings saved!</span>
    </div>
    <main class="glass-card">
        <div class="profile-block">
            <img src="images/profile.png" alt="Profile picture of Brennan" class="profile-pic">
            <div class="profile-details">
                <h1 class="name">Brennan</h1>
                <div class="badges-row">
                    <span class="badge rainbow-badge">Bisexual</span>
                    <span class="pronouns">(he/him)</span>
                </div>
                <p class="bio">Hey! I'm Brennan, a 19-year-old high school graduate and full stack developer. I love building cool things, learning new tech, and sharing my work with the world. Welcome to my digital space!</p>
            </div>
        </div>
        <div class="links-row">
            <a href="pages/projects.html" class="icon-btn" title="Projects"><span class="icon">üìÅ</span> Projects</a>
            <a href="pages/skills.html" class="icon-btn" title="Skills"><span class="icon">‚ö°</span> Skills</a>
            <a href="https://discordapp.com/users/1342454323027775549" class="icon-btn" title="Discord"><span class="icon">üí¨</span> Discord</a>
            <a href="https://github.com/Brennann06" class="icon-btn" title="GitHub"><span class="icon">üêô</span> GitHub</a>
        </div>
        <details class="settings-panel">
            <summary class="icon-btn settings-btn"><span class="icon">‚öôÔ∏è</span> Settings <span class="icon arrow">‚ñº</span></summary>
            <div class="settings-content">
                <details class="audio-settings">
                    <summary class="settings-menu-item"><span class="icon">üîä</span> Audio <span class="icon arrow">‚ñº</span></summary>
                    <div class="audio-controls">
                        <label for="volume">Music Volume</label>
                        <input type="range" id="volume" min="0" max="100" value="20" class="volume-slider">
                        <button id="muteBtn" class="control-btn"><span class="icon">üîä</span></button>
                        <div class="audio-selection">
                            <label>Background Music:</label>
                            <select id="audioSelect" class="audio-select">
                                <option value="background.wav">Calm Lofi</option>
                                <option value="background2.wav">Chill Lofi</option>
                            </select>
                        </div>
                    </div>
                </details>
                <details class="theme-settings">
                    <summary class="settings-menu-item"><span class="icon">üé®</span> Theme <span class="icon arrow">‚ñº</span></summary>
                    <div class="theme-controls">
                        <button class="theme-option" data-theme="default">Default Theme</button>
                        <button class="theme-option" data-theme="dark">Dark Theme</button>
                    </div>
                </details>
                <details class="background-settings">
                    <summary class="settings-menu-item"><span class="icon">üèûÔ∏è</span> Background <span class="icon arrow">‚ñº</span></summary>
                    <div class="background-controls">
                        <div class="transparency-control">
                            <label for="cardTransparency">Card Transparency</label>
                            <input type="range" id="cardTransparency" min="0" max="100" value="85" class="volume-slider">
                        </div>
                        <button class="bg-option" data-image="background.png">
                            <img src="images/background.png" alt="Galaxy Background Thumbnail">
                            <span>Galaxy</span>
                        </button>
                        <button class="bg-option" data-image="background2.png">
                            <img src="images/background2.png" alt="Nebula Background Thumbnail">
                            <span>Nebula</span>
                        </button>
                    </div>
                </details>
                <button id="mainResetBtn" class="icon-btn">Reset All Settings</button>
            </div>
        </details>
    </main>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize particles
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: '#ffffff' },
                    shape: { type: 'circle' },
                    opacity: {
                        value: 0.5,
                        random: true,
                        anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false }
                    },
                    size: {
                        value: 3,
                        random: true,
                        anim: { enable: true, speed: 2, size_min: 0.1, sync: false }
                    },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: '#ffffff',
                        opacity: 0.2,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 1,
                        direction: 'none',
                        random: true,
                        straight: false,
                        out_mode: 'out',
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: 'canvas',
                    events: {
                        onhover: { enable: true, mode: 'grab' },
                        onclick: { enable: true, mode: 'push' },
                        resize: true
                    },
                    modes: {
                        grab: { distance: 140, line_linked: { opacity: 0.5 } },
                        push: { particles_nb: 4 }
                    }
                },
                retina_detect: true
            });

            // Grab all the elements we need to work with
            const audio = document.getElementById('backgroundMusic');
            const volumeSlider = document.getElementById('volume');
            const muteBtn = document.getElementById('muteBtn');
            const bgOptions = document.querySelectorAll('.bg-option');
            const backgroundDiv = document.querySelector('.background');
            const glassCard = document.querySelector('.glass-card');
            const transparencySlider = document.getElementById('cardTransparency');
            const audioSelect = document.getElementById('audioSelect');
            const themeOptions = document.querySelectorAll('.theme-option');
            const notification = document.querySelector('.settings-notification');

            let isMuted = false;
            let notificationTimeout;

            // Function to show settings notification
            function showNotification(message) {
                // Clear any existing timeout
                if (notificationTimeout) {
                    clearTimeout(notificationTimeout);
                }

                // Update message and show notification
                notification.querySelector('.message').textContent = message;
                notification.classList.add('show');

                // Hide notification after 3 seconds
                notificationTimeout = setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Default values for all settings
            const defaultVolume = 0.2;
            const defaultBackground = 'background.png';
            const defaultTransparency = 85;
            const defaultAudio = 'background.wav';
            const defaultTheme = 'default';
            
            // Pick up where the music left off if we had to reload the page
            const savedTime = sessionStorage.getItem('audioTime');
            if (savedTime) {
                audio.currentTime = parseFloat(savedTime);
            }

            // Load the user's background preference or use default
            const savedBackground = localStorage.getItem('backgroundImage');
            if (savedBackground) {
                backgroundDiv.style.backgroundImage = `url('images/${savedBackground}')`;
            } else {
                backgroundDiv.style.backgroundImage = `url('images/${defaultBackground}')`;
                document.body.classList.remove('no-background-blur');
            }

            // Load the user's transparency preference or use default
            const savedTransparency = localStorage.getItem('cardTransparency');
            if (savedTransparency !== null) {
                const transparencyValue = parseInt(savedTransparency, 10);
                transparencySlider.value = transparencyValue;
                applyTransparency(transparencyValue);
            } else {
                transparencySlider.value = defaultTransparency;
                applyTransparency(defaultTransparency);
            }

            // Load the user's audio preference or use default
            const savedAudio = localStorage.getItem('backgroundAudio');
            if (savedAudio) {
                audioSelect.value = savedAudio;
                audio.src = `sounds/${savedAudio}`;
            } else {
                audioSelect.value = defaultAudio;
                audio.src = `sounds/${defaultAudio}`;
            }

            // Load the user's theme preference or use default
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.body.setAttribute('data-theme', savedTheme);
            } else {
                document.body.setAttribute('data-theme', defaultTheme);
            }

            // Keep track of where we are in the music in case of page reload
            setInterval(() => {
                sessionStorage.setItem('audioTime', audio.currentTime);
            }, 1000);

            // Try to start the music, with fallback for browsers that block autoplay
            function startAudio() {
                audio.volume = volumeSlider.value / 100;
                let playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        console.log("Music started playing");
                    })
                    .catch(error => {
                        console.log("Couldn't start music automatically:", error);
                        // Some browsers block autoplay - wait for user interaction
                        document.body.addEventListener('click', function playOnClick() {
                            audio.play();
                            document.body.removeEventListener('click', playOnClick);
                        }, { once: true });
                    });
                }
            }

            // Update the glass card's transparency and glow effects
            function applyTransparency(value) {
                const alpha = value / 100;
                // Make the card more or less see-through
                glassCard.style.background = `linear-gradient(to bottom, rgba(41, 52, 98, ${alpha * 0.85}), rgba(13, 17, 38, ${alpha * 0.8}))`;
                // Adjust the glow effect to match
                glassCard.style.boxShadow = `0 8px 40px 0 rgba(0, 0, 0, ${alpha * 0.06}), 0 1.5px 8px 0 rgba(0,0,0,${alpha * 0.03}), 0 0 ${alpha * 30}px rgba(41, 52, 98, ${alpha * 0.15})`;
            }

            // Volume slider controls
            volumeSlider.addEventListener('input', function() {
                audio.volume = this.value / 100;
                if (this.value == 0) {
                    muteBtn.innerHTML = '<span class="icon">üîá</span>';
                    isMuted = true;
                } else {
                    muteBtn.innerHTML = '<span class="icon">üîä</span>';
                    isMuted = false;
                }
                showNotification('Volume adjusted');
            });

            // Mute button toggle
            muteBtn.addEventListener('click', function() {
                if (isMuted) {
                    audio.volume = volumeSlider.value / 100;
                    this.innerHTML = '<span class="icon">üîä</span>';
                    isMuted = false;
                    showNotification('Sound unmuted');
                } else {
                    audio.volume = 0;
                    this.innerHTML = '<span class="icon">üîá</span>';
                    isMuted = true;
                    showNotification('Sound muted');
                }
            });

            // Background image switcher
            bgOptions.forEach(button => {
                button.addEventListener('click', function() {
                    const imageName = this.getAttribute('data-image');
                    backgroundDiv.style.backgroundImage = `url('images/${imageName}')`;
                    localStorage.setItem('backgroundImage', imageName);
                    showNotification('Background changed');
                });
            });

            // Transparency slider controls
            transparencySlider.addEventListener('input', function() {
                const transparencyValue = this.value;
                applyTransparency(transparencyValue);
                localStorage.setItem('cardTransparency', transparencyValue);
                showNotification('Transparency adjusted');
            });

            // Music track switcher
            audioSelect.addEventListener('change', function() {
                const selectedAudio = this.value;
                audio.src = `sounds/${selectedAudio}`;
                audio.play();
                localStorage.setItem('backgroundAudio', selectedAudio);
                showNotification('Music track changed');
            });

            // Theme switcher
            themeOptions.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedTheme = this.getAttribute('data-theme');
                    document.body.setAttribute('data-theme', selectedTheme);
                    localStorage.setItem('theme', selectedTheme);
                    showNotification('Theme changed');
                });
            });

            // Settings reset handler
            document.getElementById('mainResetBtn').addEventListener('click', function() {
                const resetChoice = prompt("Which settings would you like to reset?\nType 'Audio', 'Transparency', 'Theme', or 'All'.").toLowerCase();

                if (resetChoice === 'audio') {
                    // Reset all audio-related settings
                    audio.volume = defaultVolume;
                    volumeSlider.value = defaultVolume * 100;
                    muteBtn.innerHTML = '<span class="icon">üîä</span>';
                    isMuted = false;
                    sessionStorage.removeItem('audioTime');
                    audio.currentTime = 0;
                    audioSelect.value = defaultAudio;
                    audio.src = `sounds/${defaultAudio}`;
                    localStorage.removeItem('backgroundAudio');
                    showNotification('Audio settings reset');

                } else if (resetChoice === 'transparency') {
                    // Reset transparency only
                    transparencySlider.value = defaultTransparency;
                    applyTransparency(defaultTransparency);
                    localStorage.removeItem('cardTransparency');
                    showNotification('Transparency settings reset');

                } else if (resetChoice === 'theme') {
                    // Reset theme
                    document.body.setAttribute('data-theme', defaultTheme);
                    localStorage.removeItem('theme');
                    showNotification('Theme settings reset');

                } else if (resetChoice === 'all') {
                    // Reset audio settings
                    audio.volume = defaultVolume;
                    volumeSlider.value = defaultVolume * 100;
                    muteBtn.innerHTML = '<span class="icon">üîä</span>';
                    isMuted = false;
                    sessionStorage.removeItem('audioTime');
                    audio.currentTime = 0;
                    audioSelect.value = defaultAudio;
                    audio.src = `sounds/${defaultAudio}`;
                    localStorage.removeItem('backgroundAudio');

                    // Reset background image
                    backgroundDiv.style.backgroundImage = `url('images/${defaultBackground}')`;
                    localStorage.removeItem('backgroundImage');
                    document.body.classList.remove('no-background-blur');

                    // Reset transparency
                    transparencySlider.value = defaultTransparency;
                    applyTransparency(defaultTransparency);
                    localStorage.removeItem('cardTransparency');

                    // Reset theme
                    document.body.setAttribute('data-theme', defaultTheme);
                    localStorage.removeItem('theme');

                    showNotification('All settings reset');
                } else {
                    showNotification('No settings were reset');
                }
            });

            startAudio();
            document.addEventListener('click', startAudio, { once: true });
            document.addEventListener('touchstart', startAudio, { once: true });
            document.addEventListener('keydown', startAudio, { once: true });
        });
    </script>
</body>
</html>
